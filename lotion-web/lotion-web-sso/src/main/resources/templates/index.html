<html>
<head>
<link rel="stylesheet" href="webjars/bootstrap/3.2.0/css/bootstrap.min.css"/>
<style type="text/css">
[ng\:cloak], [ng-cloak], .ng-cloak {
	display: none !important;
}
</style>
</head>
<body ng-app="sso" ng-cloak class="ng-cloak">
	<div ng-controller="navigation" class="container">
		<ul class="nav nav-pills" role="tablist">
			<li ng-class="{active:tab('home')}"><a href='#/'>home</a></li>
			<li ng-class="{active:tab('dashboard')}" ng-show="authenticated"><a href='#/dashboard'>dashboard</a></li>
			<li><a href='dashboard/login'>login</a></li>
			<li ng-show="authenticated"><a href='' ng-click="logout()">logout</a></li>
		</ul>
		<div>Authenticated: {{user}}</div>
	</div>
	<div ng-view class="container"></div>
	<script src="webjars/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
	<script src="webjars/bootstrap/3.2.0/js/bootstrap.min.js"
		type="text/javascript"></script>
	<script src="webjars/angularjs/1.3.2/angular.min.js"
		type="text/javascript"></script>
	<script src="webjars/angularjs/1.3.2/angular-route.min.js"
		type="text/javascript"></script>
	<script src="webjars/angularjs/1.3.2/angular-resource.min.js"
		type="text/javascript"></script>
	<script src="webjars/angularjs/1.3.2/angular-cookies.min.js"
		type="text/javascript"></script>
	<script type="text/javascript">
        angular.module('sso', [ 'ngRoute', 'ngResource' ]).config(
            function($routeProvider) {

                $routeProvider.otherwise('/');
                $routeProvider.when('/', {
                    templateUrl : 'home',
                    controller : 'home'
                }).when('/dashboard', {
                    templateUrl : 'dashboard',
                    controller : 'dashboard'
                });

            }).controller('navigation', function($scope, $http, $window, $route) {
            $scope.tab = function(route) {
                return $route.current && route === $route.current.controller;
            };
            if (!$scope.user) {
                $http.get('/dashboard/user').success(function(data) {
                    $scope.user = data;
                    $scope.authenticated = true;
                }).error(function() {
                    $scope.authenticated = false;
                });
            }
            $scope.logout = function() {
                $http.post('/dashboard/logout', {}).success(function() {
                    delete $scope.user;
                    $scope.authenticated = false;
                    // Force reload of home page to reset all state after logout
                    $window.location.hash = '';
                });
            };
        }).controller('home', function() {
        }).controller('dashboard', function($scope, $resource) {

            $resource('/dashboard/message', {}).get({}, function(data) {
                $scope.message = data.message;
            }, function() {
                $scope.message = '';
            });

        });
	</script>
</body>
</html>